# Sprint: Platform Features + Tech Debt

**Date:** 2026-02-27
**Ratio:** 75% platform features / 25% tech debt

---

## Goal

Ship all 3 remaining cross-tool platform features (Personal Profile, Tradition Selector, Share via URL) and targeted tech debt (SW update notifications, World Tree spread). Finishes the platform feature layer.

---

## Tasks

### Tech Debt
- [x] **Service Worker Update Notifications** — postMessage on activate + banner in theme-manager.js
- [x] **Rune Caster: World Tree Spread** — 9-rune Yggdrasil layout in SPREADS + grid CSS

### Platform Features
- [x] **Personal Profile** — profile-manager.js (name/birthdate/tradition), Save/Load in Numerology, tradition dropdown, "Cast for: Name" in Rune + Ogham
- [x] **Tradition Selector** — traditions[] added to all 154 correspondence items, 93 crystals, 22 herbs, 15 candles; filter UI in Crystal DB + Correspondence Lookup; profile auto-selects
- [x] **Share via URL** — share-utils.js with encode/decode/modal; Rune + Ogham share reading + URL restore; Spell Builder share + read-only modal + Add to Grimoire

---

## Checklist

### Tech Debt
- [x] `sw.js` — postMessage to clients on activate
- [x] `js/theme-manager.js` — controllerchange + message listener, showUpdateBanner()

### World Tree Spread
- [x] `js/rune-script.js` — 'world-tree' entry in SPREADS (9 positions)
- [x] `html/rune-caster.html` — option + spreadDescriptions entry
- [x] `css/rune-styles.css` — CSS grid for 9-rune world tree layout

### Personal Profile
- [x] `js/profile-manager.js` — NEW: getProfile(), saveProfile(), loadProfile()
- [x] `html/numerology-calculator.html` + `js/numerology-script.js` — Save/Load Profile + tradition selector
- [x] `html/rune-caster.html` — "Cast for: [Name]" subtitle
- [x] `html/ogham-oracle.html` — "Cast for: [Name]" subtitle

### Tradition Selector
- [x] `js/correspondence-data.js` — traditions[] added to all 154 items
- [x] `js/crystal-script.js` — traditions[] added to all 93 crystals + tradition filter + profile auto-select
- [x] `js/herbal-script.js` — traditions[] added to all 22 herbs
- [x] `js/candle-magic-script.js` — traditions[] added to all 15 colors
- [x] `html/correspondence-lookup.html` + `js/correspondence-script.js` — tradition filter dropdown + profile auto-select
- [x] `html/crystal-database.html` — tradition filter dropdown added
- [x] `css/shared-theme.css` — .profile-cast-for, .profile-actions, .profile-status

### Share via URL
- [x] `js/share-utils.js` — NEW: encodeReading(), decodeReading(), buildShareURL(), checkShareParam(), showShareModal()
- [x] `html/rune-caster.html` + inline JS — Share Reading button + URL restore from ?reading=
- [x] `html/ogham-oracle.html` + inline JS — Share Reading button + URL restore from ?reading=
- [x] `html/spell-builder.html` + `js/spell-builder-script.js` — Share button on grimoire cards + showSharedSpell() modal + Add to Grimoire

### Close
- [x] `sw.js` — bump to v2.0, add profile-manager.js + share-utils.js to PRECACHE_ASSETS
- [x] `ROADMAP.md` — mark all items done, update tool table
- [x] Archive to `sprints/SPRINT-2026-02-27d.md`
- [ ] Commit

---

## Close

**Estimated:** ~12h | **Actual:** ~1 session
**Files changed:** sw.js, theme-manager.js, rune-script.js, rune-caster.html, rune-styles.css, profile-manager.js (NEW), numerology-calculator.html, numerology-script.js, ogham-oracle.html, correspondence-data.js, crystal-script.js, crystal-database.html, herbal-script.js, candle-magic-script.js, correspondence-lookup.html, correspondence-script.js, shared-theme.css, share-utils.js (NEW), spell-builder.html, spell-builder-script.js, ROADMAP.md

**Learnings:**
- Python `re.sub` with DOTALL is powerful for JS data file transformation but requires care around section boundaries (JS arrays need commas between elements at section breaks)
- traditions[] backfill across 154 + 93 + 22 + 15 items = 284 total — Python batch transformation was essential; individual edits would have been impractical
- Share via URL with Base64 encoding is simpler than expected; the key insight is encoding indices (not full objects) for compact rune/few readings
- Profile manager as a standalone utility (profile-manager.js) works cleanly — any tool can getProfile() without coupling
