<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rune Caster - Elder Futhark Divination | Mystical Path Tools</title>    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#8b5cf6">
        <link rel="stylesheet" href="../css/shared-theme.css">
    <link rel="stylesheet" href="../css/rune-styles.css">
    <link rel="stylesheet" href="../css/expandable-card.css">
    <link rel="stylesheet" href="../css/nav-menu.css">
    <link rel="stylesheet" href="../css/print.css">
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">‚Üê Back to Tools</a>
        
        <header>
            <h1>·ö± Elder Futhark Rune Caster</h1>
            <p class="subtitle">Ancient Norse Wisdom Through the Elder Futhark</p>
            <p id="profile-cast-for" class="profile-cast-for" style="display:none;"></p>
            <div class="theme-selector">
                <label for="mystical-path">Theme:</label>
                <select id="mystical-path">
                    <option value="chaos-magick">Chaos Magick</option>
                    <option value="shadow-work">Shadow Work</option>
                    <option value="golden-dawn">Golden Dawn</option>
                    <option value="green-witchcraft">Green Witchcraft</option>
                    <option value="blood-moon">Blood Moon</option>
                    <option value="lunar-tides">Lunar Tides</option>
                </select>
            </div>
        </header>

        <!-- Rune of the Day -->
        <section id="rune-of-day-section" class="rune-of-day-section" role="region" aria-labelledby="rune-of-day-heading">
            <div id="rune-of-day-card" class="rune-of-day-card">
                <!-- Populated by JS -->
            </div>
        </section>

        <!-- Spread Selection -->
        <section class="spread-selection" role="region" aria-labelledby="cast-heading">
            <h2 id="cast-heading">Cast the Runes</h2>
            <p class="intro-text">
                The Elder Futhark consists of 24 ancient runes used by Norse and Germanic peoples for divination, 
                magic, and communication. Each rune carries deep symbolic meaning and can guide you through 
                life's questions. Select your spread and cast the runes to receive their wisdom.
            </p>
            
            <div class="spread-controls">
                <div class="control-group">
                    <label for="spread-selector">Choose Your Spread:</label>
                    <select id="spread-selector" aria-label="Choose rune spread type">
                        <option value="daily-draw">Daily Rune (1 rune)</option>
                        <option value="three-rune">Past-Present-Future (3 runes)</option>
                        <option value="five-cross" selected>Five Rune Cross (5 runes)</option>
                        <option value="runic-cross">Runic Cross (6 runes)</option>
                        <option value="world-tree">World Tree / Yggdrasil (9 runes)</option>
                    </select>
                </div>

                <div class="cast-controls-row">
                    <button id="cast-button" class="cast-btn">Cast the Runes ·õü</button>
                    <button id="study-mode-btn" class="study-mode-btn" aria-label="Open rune study flashcard mode">üìö Study Mode</button>
                </div>
            </div>
            
            <div class="spread-info" id="spread-info">
                <h3>Five Rune Cross</h3>
                <p>Deep insight into challenges and outcomes. This spread reveals your current position, 
                the obstacles you face, the foundation from your past, the path ahead, and the ultimate outcome.</p>
            </div>
        </section>

        <!-- Study Mode Section (hidden initially) -->
        <section id="study-section" class="study-section" style="display:none;" role="region" aria-labelledby="study-heading">
            <div class="study-header">
                <h2 id="study-heading">üìö Rune Study Mode</h2>
                <button id="study-back-btn" class="secondary-btn" aria-label="Back to rune casting">‚Üê Back to Reading</button>
            </div>

            <!-- Aett filter -->
            <div class="study-aett-filter" role="group" aria-label="Filter runes by aett">
                <button class="study-filter-btn active" data-aett="all" aria-pressed="true">All (24)</button>
                <button class="study-filter-btn" data-aett="Freya" aria-pressed="false">Freya's Aett (8)</button>
                <button class="study-filter-btn" data-aett="Heimdall" aria-pressed="false">Heimdall's Aett (8)</button>
                <button class="study-filter-btn" data-aett="Tyr" aria-pressed="false">Tyr's Aett (8)</button>
            </div>

            <!-- Progress bar -->
            <div class="study-progress-container" aria-label="Study progress">
                <div class="study-progress-bar">
                    <div id="study-progress-fill" class="study-progress-fill" style="width: 0%;"></div>
                </div>
                <span id="study-progress-label" class="study-progress-label">0 / 24 known</span>
            </div>

            <!-- Flashcard -->
            <div id="study-flashcard" class="study-flashcard" aria-live="polite">
                <div class="flashcard-front">
                    <div id="study-rune-symbol" class="study-rune-symbol">·ö†</div>
                    <div id="study-rune-name" class="study-rune-name">Fehu</div>
                    <div id="study-rune-aett" class="study-rune-aett">Freya's Aett</div>
                    <button id="reveal-btn" class="reveal-btn" aria-label="Reveal rune meaning">Reveal Meaning</button>
                </div>
                <div id="study-meaning-panel" class="study-meaning-panel" style="display:none;">
                    <div class="study-meaning-upright">
                        <h4>Upright</h4>
                        <div id="study-upright-keywords" class="study-keyword-row"></div>
                        <p id="study-upright-meaning"></p>
                    </div>
                    <div class="study-meaning-divider">‚ú¶</div>
                    <div class="study-meaning-reversed">
                        <h4>Reversed</h4>
                        <div id="study-reversed-keywords" class="study-keyword-row reversed-keywords"></div>
                        <p id="study-reversed-meaning"></p>
                    </div>
                </div>
            </div>

            <!-- Mark buttons -->
            <div id="study-mark-btns" class="study-mark-btns" style="display:none;">
                <button id="mark-learning-btn" class="mark-btn mark-learning" aria-label="Mark as still learning">Still Learning</button>
                <button id="mark-known-btn" class="mark-btn mark-known" aria-label="Mark as known">Known ‚úì</button>
            </div>

            <!-- Navigation -->
            <div class="study-nav">
                <button id="study-prev-btn" class="secondary-btn" aria-label="Previous rune">‚Üê Prev</button>
                <span id="study-card-counter" class="study-card-counter">1 / 24</span>
                <button id="study-shuffle-btn" class="secondary-btn" aria-label="Shuffle study queue">Shuffle</button>
                <button id="study-next-btn" class="secondary-btn" aria-label="Next rune">Next ‚Üí</button>
            </div>
        </section>

        <!-- Rune Display (hidden initially) -->
        <section id="rune-display" class="rune-display-section" style="display: none;" role="region" aria-live="polite" aria-labelledby="reading-heading">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="reading-heading" style="margin: 0;">Your Reading</h2>
                <button class="pdf-download-btn" onclick="downloadToolAsPDF('Rune Caster', 'reading')" aria-label="Download rune reading as PDF">üìÑ Download PDF</button>
            </div>
            <div id="rune-grid" class="rune-grid" role="list"></div>
            
            <div class="reading-actions">
                <button id="cast-button-2" class="secondary-btn">Cast Again</button>
                <button id="share-reading-btn" class="secondary-btn" aria-label="Share this reading via URL" style="display:none;">üîó Share Reading</button>
            </div>
        </section>

        <!-- Reading History -->
        <section class="reading-history-section" role="region" aria-labelledby="reading-history-heading">
            <h2 id="reading-history-heading">Reading History</h2>
            <div class="history-controls">
                <button id="toggle-history-btn" class="toggle-btn" aria-label="Show reading history">
                    <span class="toggle-icon">‚ñº</span>
                    <span class="toggle-text">Show History</span>
                </button>
                <button id="clear-history-btn" class="clear-history-btn" aria-label="Clear all reading history">Clear History</button>
            </div>
            <div id="history-list" class="history-list" role="list" style="display: none;"></div>
            <div id="history-empty" class="empty-state">
                <p class="empty-icon">·ö±</p>
                <p class="empty-text">No readings saved yet.</p>
                <p class="empty-subtext">Cast the runes to begin your reading history.</p>
            </div>
        </section>

        <!-- Bind Rune Creator -->
        <section class="bind-rune-section" role="region" aria-labelledby="bind-heading">
            <h2 id="bind-heading">Bind Rune Creator</h2>
            <p class="section-description">
                Create a bind rune by combining 2-5 runes into a single powerful symbol. 
                Select the runes whose energies you wish to merge, then combine them on the canvas below.
            </p>
            
            <div class="bind-rune-container">
                <div class="rune-selector-grid">
                    <h3>Select Runes to Bind</h3>
                    <div class="rune-checkboxes">
                        <!-- Freya's Aett -->
                        <div class="aett-group">
                            <h4>Freya's Aett</h4>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Fehu">
                                <span class="checkbox-rune">·ö† Fehu</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Uruz">
                                <span class="checkbox-rune">·ö¢ Uruz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Thurisaz">
                                <span class="checkbox-rune">·ö¶ Thurisaz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Ansuz">
                                <span class="checkbox-rune">·ö® Ansuz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Raidho">
                                <span class="checkbox-rune">·ö± Raidho</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Kenaz">
                                <span class="checkbox-rune">·ö≤ Kenaz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Gebo">
                                <span class="checkbox-rune">·ö∑ Gebo</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Wunjo">
                                <span class="checkbox-rune">·öπ Wunjo</span>
                            </label>
                        </div>
                        
                        <!-- Heimdall's Aett -->
                        <div class="aett-group">
                            <h4>Heimdall's Aett</h4>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Hagalaz">
                                <span class="checkbox-rune">·ö∫ Hagalaz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Nauthiz">
                                <span class="checkbox-rune">·öæ Nauthiz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Isa">
                                <span class="checkbox-rune">·õÅ Isa</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Jera">
                                <span class="checkbox-rune">·õÉ Jera</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Eihwaz">
                                <span class="checkbox-rune">·õá Eihwaz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Perthro">
                                <span class="checkbox-rune">·õà Perthro</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Algiz">
                                <span class="checkbox-rune">·õâ Algiz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Sowilo">
                                <span class="checkbox-rune">·õä Sowilo</span>
                            </label>
                        </div>
                        
                        <!-- Tyr's Aett -->
                        <div class="aett-group">
                            <h4>Tyr's Aett</h4>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Tiwaz">
                                <span class="checkbox-rune">·õè Tiwaz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Berkano">
                                <span class="checkbox-rune">·õí Berkano</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Ehwaz">
                                <span class="checkbox-rune">·õñ Ehwaz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Mannaz">
                                <span class="checkbox-rune">·õó Mannaz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Laguz">
                                <span class="checkbox-rune">·õö Laguz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Ingwaz">
                                <span class="checkbox-rune">·õù Ingwaz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Dagaz">
                                <span class="checkbox-rune">·õû Dagaz</span>
                            </label>
                            <label class="rune-checkbox-label">
                                <input type="checkbox" class="bind-rune-checkbox" value="Othala">
                                <span class="checkbox-rune">·õü Othala</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="canvas-area">
                    <h3>Your Bind Rune</h3>
                    <canvas id="bind-canvas" width="600" height="600" aria-label="Canvas for creating bind rune"></canvas>
                    <div class="bind-controls">
                        <button id="combine-button" class="primary-btn" aria-label="Combine selected runes into bind rune">Combine Runes</button>
                        <button id="clear-bind" class="secondary-btn" aria-label="Clear bind rune canvas">Clear Canvas</button>
                        <button id="download-bind" class="secondary-btn" aria-label="Download bind rune as PNG">Download PNG</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Rune Reference Guide -->
        <section class="rune-reference" role="region" aria-labelledby="reference-heading">
            <h2 id="reference-heading">Elder Futhark Reference</h2>
            <p class="section-description">
                Quick reference for all 24 runes of the Elder Futhark, organized by their traditional aetts (families).
            </p>
            
            <div class="reference-grid">
                <div class="ref-aett" role="list" aria-label="Freya's Aett runes">
                    <h3>Freya's Aett</h3>
                    <p class="aett-description">Themes of creation, abundance, and new beginnings</p>
                    <div class="ref-runes">
                        <span class="ref-rune">·ö† Fehu</span>
                        <span class="ref-rune">·ö¢ Uruz</span>
                        <span class="ref-rune">·ö¶ Thurisaz</span>
                        <span class="ref-rune">·ö® Ansuz</span>
                        <span class="ref-rune">·ö± Raidho</span>
                        <span class="ref-rune">·ö≤ Kenaz</span>
                        <span class="ref-rune">·ö∑ Gebo</span>
                        <span class="ref-rune">·öπ Wunjo</span>
                    </div>
                </div>
                
                <div class="ref-aett" role="list" aria-label="Heimdall's Aett runes">
                    <h3>Heimdall's Aett</h3>
                    <p class="aett-description">Themes of challenge, transformation, and growth through adversity</p>
                    <div class="ref-runes">
                        <span class="ref-rune">·ö∫ Hagalaz</span>
                        <span class="ref-rune">·öæ Nauthiz</span>
                        <span class="ref-rune">·õÅ Isa</span>
                        <span class="ref-rune">·õÉ Jera</span>
                        <span class="ref-rune">·õá Eihwaz</span>
                        <span class="ref-rune">·õà Perthro</span>
                        <span class="ref-rune">·õâ Algiz</span>
                        <span class="ref-rune">·õä Sowilo</span>
                    </div>
                </div>
                
                <div class="ref-aett" role="list" aria-label="Tyr's Aett runes">
                    <h3>Tyr's Aett</h3>
                    <p class="aett-description">Themes of spiritual development, self-mastery, and completion</p>
                    <div class="ref-runes">
                        <span class="ref-rune">·õè Tiwaz</span>
                        <span class="ref-rune">·õí Berkano</span>
                        <span class="ref-rune">·õñ Ehwaz</span>
                        <span class="ref-rune">·õó Mannaz</span>
                        <span class="ref-rune">·õö Laguz</span>
                        <span class="ref-rune">·õù Ingwaz</span>
                        <span class="ref-rune">·õû Dagaz</span>
                        <span class="ref-rune">·õü Othala</span>
                    </div>
                </div>
            </div>
        </section>

        <footer>
            <p class="footer-text">
                The Elder Futhark runes are an ancient alphabet used by Germanic peoples. 
                This tool is for divination and spiritual exploration. Trust your intuition when interpreting the runes.
            </p>
            <p class="wisdom">
                <em>"The runes will find you when you need them most."</em>
            </p>
        </footer>
    </div>

    <script src="../js/theme-manager.js"></script>
    <script src="../js/nav-menu.js"></script>
    <script src="../js/filter-utils.js"></script>
    <script src="../js/canvas-utils.js"></script>
    <script src="../js/pdf-utils.js"></script>
    <script src="../js/profile-manager.js"></script>
    <script src="../js/share-utils.js"></script>
    <script src="../js/rune-script.js"></script>
    
    <script>
        // Spread info updater
        const spreadSelector = document.getElementById('spread-selector');
        const spreadInfo = document.getElementById('spread-info');
        const castButton2 = document.getElementById('cast-button-2');
        
        const spreadDescriptions = {
            'daily-draw': {
                name: 'Daily Rune',
                description: 'A single rune for daily guidance and reflection. Perfect for morning meditation or quick insight into the day ahead.'
            },
            'three-rune': {
                name: 'Past-Present-Future',
                description: 'Classic three rune spread showing the flow of time. Understand how past influences shape your present and future.'
            },
            'five-cross': {
                name: 'Five Rune Cross',
                description: 'Deep insight into challenges and outcomes. This spread reveals your current position, the obstacles you face, the foundation from your past, the path ahead, and the ultimate outcome.'
            },
            'runic-cross': {
                name: 'Runic Cross (6 Runes)',
                description: 'Comprehensive reading with spiritual and material aspects. Examines your situation from multiple dimensions including higher purpose and earthly concerns.'
            },
            'world-tree': {
                name: 'World Tree ‚Äî Yggdrasil (9 Runes)',
                description: 'A nine-realm spread mirroring the cosmic World Tree of Norse cosmology. Moving from the deep roots of your hidden foundation through the branches of your future to the crown of destiny.'
            }
        };
        
        spreadSelector.addEventListener('change', () => {
            const selected = spreadDescriptions[spreadSelector.value];
            spreadInfo.innerHTML = `
                <h3>${selected.name}</h3>
                <p>${selected.description}</p>
            `;
        });
        
        // Second cast button
        if (castButton2) {
            castButton2.addEventListener('click', () => {
                const spreadKey = spreadSelector.value;
                const spread = SPREADS[spreadKey];
                currentCast = castRunes(spread.positions);
                displaySpread(spreadKey, currentCast);
                addToRuneHistory(spreadKey, currentCast);
            });
        }

        // Show profile name if set
        const _runeProfile = getProfile();
        if (_runeProfile.name) {
            const castFor = document.getElementById('profile-cast-for');
            if (castFor) {
                castFor.textContent = `Cast for: ${_runeProfile.name}`;
                castFor.style.display = '';
            }
        }

        // ‚îÄ‚îÄ‚îÄ Share Reading ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const shareBtn = document.getElementById('share-reading-btn');
        let _lastSpreadKey = null;

        function showShareBtn(spreadKey) {
            _lastSpreadKey = spreadKey;
            if (shareBtn) shareBtn.style.display = '';
        }

        // Wrap the cast button to capture spread key for share
        const _origCastListener = castButton ? castButton.onclick : null;
        if (castButton) {
            castButton.addEventListener('click', () => {
                showShareBtn(spreadSelector.value);
            });
        }
        if (castButton2) {
            castButton2.addEventListener('click', () => {
                showShareBtn(spreadSelector.value);
            });
        }

        if (shareBtn) {
            shareBtn.addEventListener('click', () => {
                if (!currentCast || !currentCast.length || !_lastSpreadKey) return;
                const data = {
                    spread: _lastSpreadKey,
                    runes: currentCast.map(c => ({
                        idx: ELDER_FUTHARK.indexOf(c.rune),
                        reversed: c.reversed
                    }))
                };
                const url = buildShareURL('reading', data);
                if (url) showShareModal(url);
            });
        }

        // ‚îÄ‚îÄ‚îÄ Restore from URL param ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const _sharedReading = checkShareParam('reading');
        if (_sharedReading && _sharedReading.spread && Array.isArray(_sharedReading.runes)) {
            const spread = SPREADS[_sharedReading.spread];
            if (spread) {
                currentCast = _sharedReading.runes.map(r => ({
                    rune: ELDER_FUTHARK[r.idx] || ELDER_FUTHARK[0],
                    reversed: !!r.reversed
                }));
                spreadSelector.value = _sharedReading.spread;
                displaySpread(_sharedReading.spread, currentCast);
                showShareBtn(_sharedReading.spread);
                // Update spread info display
                const selected = spreadDescriptions[_sharedReading.spread];
                if (selected) {
                    document.getElementById('spread-info').innerHTML =
                        `<h3>${selected.name}</h3><p>${selected.description}</p>`;
                }
            }
        }
    </script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((reg) => console.log('‚ú® SW registered:', reg.scope))
                    .catch((err) => console.log('SW registration failed:', err));
            });
        }
    </script>
</body>
</html>
